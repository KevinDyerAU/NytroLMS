let timeZone="Australia/Sydney";moment.tz.setDefault(timeZone);var Sidebar=function(t){return t.expendParentAccordion=function(t){t.parents(".accordion-collapse").each((function(){$(this).collapse("show")}))},t}(Sidebar||{}),LMS=function(t){return t.UploadEvidence=function(t,e,s){event.preventDefault();let n=new FormData;const o=document.getElementById(e);if(o.files[0])return n.append("file",o.files[0]),n.append("student",s),n.append("_token",$('meta[name="csrf-token"]').attr("content")),axios.post("/api/v1/upload/evidence/"+t,n).then((t=>{let e=t.data;toastr.success(e.message,"Successfully Uploaded",{closeButton:!0,tapToDismiss:!0}),Student.trainingPlan(s,!0)})).then((()=>{$(document).trigger("refreshStudentActivity")})).catch((t=>{console.log(t)})),!1;toastr.warning("You need to upload a valid file.","Error",{closeButton:!0,tapToDismiss:!0})},t.UploadChecklist=function(t,e,s){event.preventDefault();let n=new FormData;const o=document.getElementById(e),a=document.getElementById(e+"_status");if(o.files[0]&&a.value&&""!==a.value&&void 0!==a.value)return n.append("file",o.files[0]),n.append("student",s),n.append("status",a.value),n.append("_token",$('meta[name="csrf-token"]').attr("content")),axios.post("/api/v1/upload/checklist/"+t,n).then((t=>{let e=t.data;toastr.success(e.message,"Successfully Uploaded",{closeButton:!0,tapToDismiss:!0}),Student.trainingPlan(s,!0)})).then((()=>{$(document).trigger("refreshStudentActivity")})).catch((t=>{console.log(t)})),!1;o.files[0]||toastr.warning("You need to upload a valid file.","Error",{closeButton:!0,tapToDismiss:!0}),a.value&&""!==a.value&&void 0!==a.value||toastr.warning("You need to select checklist status.","Error",{closeButton:!0,tapToDismiss:!0})},t.MarkWorkPlacement=function(t,e){return axios.post("/api/v1/mark/work_placement/"+t,{student:e}).then((t=>{let s=t.data;toastr.success(s.message,"Success",{closeButton:!0,tapToDismiss:!0}),Student.trainingPlan(e,!0)})).then((()=>{$(document).trigger("refreshStudentActivity")})).catch((t=>{console.log(t)}))},t.MarkLessonComplete=function(t,e){axios.post("/api/v1/mark/lesson/"+t,{student:e}).then((t=>{let s=t.data;toastr.success(s.message,"Success",{closeButton:!0,tapToDismiss:!0}),Student.trainingPlan(e,!0)})).then((()=>{$(document).trigger("refreshStudentActivity")})).catch((t=>{console.log(t)}))},t.ShowLessonCompetent=function(t){const e=JSON.parse(t),s=$("#competencies-details"),n=`<div class="border-top-light border-top-2 pt-1 mt-1">\n                                    <div class="d-flex justify-content-between flex-grow-1">\n                                        <span class="flex-grow-1">Lesson: ${e.title} </span>\n                                        <small\n                                            class="text-muted width-250">Start Date: ${e.start_date} - End Date: ${e.end_date}</small>\n                                    </div>\n                                    <h5 class="p-1 bg-light text-purple">The student is assessed as competent in all the assessment requirements for this unit of competency.</h5>\n                                    <form id="LessonCompetentForm${e.lessonID}" class="my-1">\n                                        <label for="endDate${e.lessonID}">Set Lesson End Date: </label>\n                                        <input type="text" name="endDate${e.lessonID}"\n                                         id="endDate${e.lessonID}"\n                                         data-mindate="${e.min_date}"\n                                         data-enddate="${e.end_date}"\n                                         data-startdate="${e.start_date}"\n                                          class="form-control date-picker" required="required" />\n                                        <label for="remarks${e.lessonID}">Your Remarks: </label>\n                                        <textarea class="form-control mb-1" id="remarks${e.lessonID}"></textarea>\n                                        <button class="btn btn-purple"\n                                                onclick="LMS.MarkLessonCompetent(${e.lessonID},${e.studentID})">Mark Competent\n                                        </button>\n                                    </form>\n                                </div>`;s.find(".modal-body").html(n);let o=document.getElementById("competencies-details");new bootstrap.Modal(o).show(),s.find(".date-picker").each((function(){let t=$(this).data("mindate"),e=$(this).data("enddate");e&&t&&new Date(t)<new Date(e)&&(t=e),$(this).flatpickr({dateFormat:"Y-m-d",minDate:t||new Date("2022-01-01")})}))},t.hideLessonCompetent=function(){let t=document.getElementById("competencies-details");new bootstrap.Modal(t).hide(),setTimeout((function(){$("#competencies-details").find(".modal-body").html('<h5 class="p-1 bg-light text-purple">Lesson marked competent successfully.</h5><p>You may close this now</p>')}),5e3)},t.MarkLessonCompetent=function(e,s){event.preventDefault();let n=$("#remarks"+e).val(),o=$("#endDate"+e).data("mindate"),a=$("#endDate"+e).data("enddate"),r=$("#endDate"+e).val();return r=new Date(r)<new Date(o)?o:new Date(r)<new Date(a)?a:r,axios.post("/api/v1/competent/lesson/"+e,{student:s,remarks:n,endDate:r,minDate:o,lessonEndDate:a}).then((e=>{200===e.status&&(toastr.success("Lesson marked competent","Success",{closeButton:!0,tapToDismiss:!0}),t.hideLessonCompetent(),"undefined"!=typeof Student&&Student.trainingPlan(s,!0))})).then((()=>{t.hideLessonCompetent(),"undefined"!=typeof Student?$(document).trigger("refreshStudentActivity"):location.reload()})).catch((t=>{const e=t.response?.data??"";toastr.error(e?e.errors[0].message:"","Error!",{closeButton:!0,tapToDismiss:!0,timeOut:2e3})})),!1},t.MarkTopicComplete=function(t,e){axios.post("/api/v1/mark/topic/"+t,{student:e}).then((t=>{let s=t.data;toastr.success(s.message,"Success",{closeButton:!0,tapToDismiss:!0}),Student.trainingPlan(e,!0)})).then((()=>{$(document).trigger("refreshStudentActivity")})).catch((t=>{console.log(t)}))},t.destroy=(t,e,s)=>{Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-outline-danger ms-1"},buttonsStyling:!1}).then((function(n){n.isConfirmed&&axios.delete("/api/v1/"+e+"/"+s).then((e=>{let s=e.data;toastr.success(s.message,"Success!",{closeButton:!0,tapToDismiss:!0,timeOut:2e3}),$(t.target).parents("tr").remove()})).catch((t=>{const e=t.response.data;toastr.error(e.errors[0].message,"Error!",{closeButton:!0,tapToDismiss:!0,timeOut:2e3})}))})).catch((t=>{const e=t.response.data;toastr.error(e.errors[0].message,"Error!",{closeButton:!0,tapToDismiss:!0,timeOut:2e3})}))},t.UnlockLesson=function(t,e){axios.post("/account-manager/lessons/"+t+"/unlock",{_token:$('meta[name="csrf-token"]').attr("content"),student_id:e}).then((t=>{t.data.success&&(toastr.success("Lesson unlocked successfully","Success",{closeButton:!0,tapToDismiss:!0}),Student.trainingPlan(e,!0))})).catch((t=>{toastr.error("Failed to unlock lesson","Error",{closeButton:!0,tapToDismiss:!0}),console.log(t)}))},t.LockLesson=function(t,e){axios.post("/account-manager/lessons/"+t+"/lock",{_token:$('meta[name="csrf-token"]').attr("content"),student_id:e}).then((t=>{t.data.success&&(toastr.success("Lesson locked successfully","Success",{closeButton:!0,tapToDismiss:!0}),Student.trainingPlan(e,!0))})).catch((t=>{toastr.error("Failed to lock lesson","Error",{closeButton:!0,tapToDismiss:!0}),console.log(t)}))},t}(LMS||{});
