!function(){"use strict";const t=window.idleTimeoutConfig||{},e=t.timeoutMinutes||120,n=t.warningMinutes||5,o=t.checkIntervalMs||6e4,i=t.updateIntervalMs||3e5;let a=null,s=null,r=null,l=null,c=Date.now(),u=!1,d=!1,m=null,g=null;function f(){!function(){const t=document.querySelector('meta[name="csrf-token"]');return null!==t&&""!==t.getAttribute("content")}()?console.log("User not authenticated or laravel uninit"):(["mousedown","mousemove","keypress","scroll","touchstart","click","keydown","keyup","focus","blur","resize"].forEach((t=>{document.addEventListener(t,p,!0)})),document.addEventListener("visibilitychange",v),window.addEventListener("focus",p),window.addEventListener("blur",p),y(),r=setInterval((()=>{if(d)return;const t=Date.now()-c;Math.floor(t/6e4)>=e?S():t%i<o&&E()}),o),k())}function p(){d||(c=Date.now(),y(),u&&h())}function v(){document.hidden||p()}function y(){a&&clearTimeout(a),s&&clearTimeout(s);s=setTimeout(w,60*(e-n)*1e3);a=setTimeout(S,60*e*1e3)}function w(){if(u||d)return;u=!0,m||k(),l&&clearInterval(l),"undefined"!=typeof bootstrap&&bootstrap.Modal?(g||(g=new bootstrap.Modal(m)),g.show()):m.style.display="block";let t=60*n;console.log("Starting countdown from:",t,"seconds"),b(t),l=setInterval((()=>{t--,console.log("Countdown tick:",t),b(t),t<=0&&(clearInterval(l),l=null,console.log("Countdown finished"))}),1e3)}function h(){u=!1,l&&(clearInterval(l),l=null),m&&("undefined"!=typeof bootstrap&&bootstrap.Modal?g&&g.hide():m.style.display="none")}function b(t){const e=`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`,n=m?.querySelector("#countdown");n?n.textContent=e:console.warn("Countdown element not found in modal")}function k(){m||(m=document.createElement("div"),m.className="modal fade",m.id="idle-warning-modal",m.setAttribute("data-bs-backdrop","static"),m.setAttribute("data-bs-keyboard","false"),m.innerHTML='\n            <div class="modal-dialog modal-dialog-centered">\n                <div class="modal-content">\n                    <div class="modal-header bg-warning">\n                        <h5 class="modal-title text-dark">\n                            <i data-lucide="clock" class="me-1"></i>\n                            Are you still there?\n                        </h5>\n                    </div>\n                    <div class="modal-body text-center">\n                        <h6 class="p-1">\n                            <i data-lucide="alert-triangle" class="text-warning" style="font-size: 3rem;"></i>\n                            Your session will expire due to inactivity\n                        </h6>\n                        <p class="text-muted">\n                            You will be automatically logged out in <strong id="countdown">5:00</strong>.\n                        </p>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-outline-secondary" onclick="IdleTimeout.logout()">\n                            Logout Now\n                        </button>\n                        <button type="button" class="btn btn-primary" onclick="IdleTimeout.stayLoggedIn()">\n                            Stay Logged In\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ',document.body.appendChild(m))}function S(){if(d)return;d=!0,console.log("Logging out user due to inactivity"),h(),"undefined"!=typeof toastr&&toastr.warning("Your session has expired due to inactivity. Please log in again.","Session Expired");const t=document.createElement("form");t.method="POST",t.action="/logout";const e=document.querySelector('meta[name="csrf-token"]');if(e){const n=document.createElement("input");n.type="hidden",n.name="_token",n.value=e.getAttribute("content"),t.appendChild(n)}const n=document.createElement("input");n.type="hidden",n.name="timeout",n.value="1",t.appendChild(n),document.body.appendChild(t),setTimeout((()=>{t.submit()}),1e3)}function E(){d||fetch("/api/v1/activity/update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},credentials:"same-origin"}).then((t=>{if(419===t.status||401===t.status)return console.warn("Session expired during activity update"),S(),null;if(!t.ok)throw new Error("Failed to update activity");return t.json()})).then((t=>{if(t&&t.success&&t.csrf_token){const e=document.querySelector('meta[name="csrf-token"]');e&&e.setAttribute("content",t.csrf_token)}})).catch((t=>{console.error("Error updating activity:",t)}))}window.IdleTimeout={init:f,destroy:function(){a&&clearTimeout(a),s&&clearTimeout(s),r&&clearInterval(r),l&&clearInterval(l),["mousedown","mousemove","keypress","scroll","touchstart","click","keydown","keyup","focus","blur","resize"].forEach((t=>{document.removeEventListener(t,p,!0)})),document.removeEventListener("visibilitychange",v),window.removeEventListener("focus",p),window.removeEventListener("blur",p),g&&(g.dispose(),g=null),m&&m.parentNode&&(m.parentNode.removeChild(m),m=null)},stayLoggedIn:function(){p(),h(),E()},logout:S,getSessionStatus:function(){return fetch("/api/v1/activity/status",{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},credentials:"same-origin"}).then((t=>419===t.status||401===t.status?(console.warn("Session expired during status check"),S(),null):t.json())).catch((t=>(console.error("Error getting session status:",t),null)))},updateActivity:E,showWarning:w,getStatus:function(){const t=m?.querySelector("#countdown");return{isWarningShown:u,isLoggedOut:d,countdown:t?.textContent||"N/A",lastActivityTime:new Date(c).toLocaleTimeString(),idleMinutes:Math.floor((Date.now()-c)/6e4),configTimeout:e}}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):f()}();
