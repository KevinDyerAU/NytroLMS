var Quiz=function(t){let e=document.getElementById("lms-quiz"),n=e?new Stepper(e,{linear:!1,animation:!0}):null;function s(){if(!e)return 1;const t=e.querySelectorAll(".step.questionStep"),n=e.querySelectorAll(".step.questionStep.submitted");let s=1;if(n.length>0){let e=!1;t.forEach(((t,n)=>{e||t.classList.contains("submitted")||(s=n+1,e=!0)})),e||(s=t.length)}return s}if(t.updateButtonState=function(){if(!e)return;const t=e.querySelectorAll(".step.questionStep"),n=e.querySelectorAll(".step.questionStep.submitted"),s=(t.length,n.length,e.querySelector(".content.active"));if(!s)return;const r=s.querySelector(".btn-next");if(!r)return;const i=r.getAttribute("data-questionID");r.getAttribute("data-lastQuestion");let a=!1;t.forEach((t=>{t.getAttribute("data-qid")===i&&t.classList.contains("submitted")&&(a=!0)}));const o=r.querySelector("span");o&&!o.textContent.includes("Submit Question")&&(o.textContent="Submit Question"),r.classList.remove("btn-success"),r.classList.add("btn-primary");if(!r.querySelector('i[data-lucide="arrow-right"], svg[data-lucide="arrow-right"]')){const t=document.createElement("i");t.setAttribute("data-lucide","arrow-right"),t.className="align-middle ms-sm-25 ms-0",r.appendChild(t),"undefined"!=typeof lucide&&lucide.createIcons()}},n&&e){e.querySelectorAll(".step-trigger").forEach((t=>{t.classList.remove("disabled"),t.removeAttribute("disabled")})),n.to(s()),setTimeout(t.updateButtonState,100),e.addEventListener("shown.bs-stepper",(function(e){t.updateButtonState()}))}return t.submitAnswer=(e,r,i,a=!1)=>{let o={headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:1e4,retry:3,retryDelay:1e4};a&&(o.headers["Content-Type"]="multipart/form-data",o.headers.Accept="application/json");const l=new URLSearchParams(window.location.search).get("course_id");return l&&(e.course_id=l),axios.post("/api/v1/attempt/"+r,e,o).then((e=>{let r=e.data;if(!0===r.success){toastr.success(r.message,"Success",{closeButton:!0,tapToDismiss:!0});let e=r.data.submitted_answers;$(".step.questionStep").each((function(){let t=$(this).data("qid");-1!==e.indexOf(t)&&$(this).addClass("submitted")})),setTimeout(t.updateButtonState,100),1===r.data.next_step.last?r.data.intended_url?window.location.href=r.data.intended_url:""!==i.trim()?window.location.href=i:window.location.href="/frontend/dashboard":n&&n.to(s())}else toastr.warning("Unable to submit your answer","Error",{closeButton:!0,tapToDismiss:!0})})).catch((t=>{if(void 0!==t.response&&t.response.data){const e=t.response.data;let n="\n\r Reason(s): ";$.each(e.message,(function(t,e){n+="\n\r"+t+": "+e})),toastr.warning("Unable to submit your answer: "+n,"Error",{closeButton:!0,tapToDismiss:!0})}t.response?(console.log(t.response.data),console.log(t.response.status),console.log(t.response.headers)):t.request?console.log(t.request):console.log("Error",t.message)})),event.preventDefault(),!1},t.validateESSAY=(e,n,s,r,i,a)=>{if(e){var o=tinymce.get(e).getContent();if(o.length>0){let e={answer:o,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(e,r,a)}else toastr.warning("Answer is required.","Error",{closeButton:!0,tapToDismiss:!0})}return event.preventDefault(),!1},t.validateSCQ=(e,n,s,r,i,a)=>{let o=$('input[name="answer['+s+']"]:checked').val();if(o){let e={answer:o,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(e,r,a)}else toastr.warning("Select an option for your answer ","Error",{closeButton:!0,tapToDismiss:!0});return event.preventDefault(),!1},t.validateMCQ=(e,n,s,r,i,a)=>{let o={};if($('input[name="answer['+s+']"]:checked').each((function(){const t=$(this).attr("data-mcqId");o[t]=$(this).val()})),o){let e={answer:o,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(e,r,a)}else toastr.warning("Select an option for your answer ","Error",{closeButton:!0,tapToDismiss:!0});return event.preventDefault(),!1},t.validateSORT=(e,n,s,r,i,a)=>{let o=$("#sorting-group"+s).find("li.list-group-item").find("h5"),l=[];o.each((function(){l.push($(this).text())}));let u={answer:l,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(u,r,a)},t.validateMATRIX=(e,n,s,r,i,a)=>{const o=String(s),l=$('[id^="matrix_list'+o+'_"]');let u={},c=!1,d=[];l.each((function(){const t=$(this);let e=t.data("slot-index");if(null==e){const n=t.attr("id");if(n){const t=n.match(new RegExp("matrix_list"+o+"_(\\d+)"));t&&t[1]&&(e=parseInt(t[1],10))}}else e=parseInt(e,10);let n=t.children("li.matrix-sort-item").first();if(0===n.length&&(n=t.find("li.matrix-sort-item").first()),0===n.length&&(n=t.find(".matrix-sort-item").first()),0===n.length){const e=t.children("li").not(".matrix-empty-slot").first();if(e.length>0){const t=e.find("small").length>0,s=e.text().trim().length>0,r=e.text().trim().toLowerCase().includes("drop")||e.text().trim().toLowerCase().includes("tap");!t&&!s||r||(n=e)}}if(n.length>0){let t=n.find("small").text().trim();if(!t){const e=n.clone();e.find("button").remove(),t=e.text().trim()}t||(t=n.text().trim(),n.find("button").each((function(){const e=$(this).text().trim();e&&(t=t.replace(e,"").trim())})),t=t.replace(/\s+/g," ").trim()),t&&!isNaN(e)&&e>=0&&(u[e]=t,c=!0)}else!isNaN(e)&&e>=0&&d.push(e+1)}));const m={questionID:o,destinationSlots:l.length,questionVal:u,hasAnswers:c,emptySlots:d,slotsChecked:l.map((function(){const t=$(this),e=t.children("li.matrix-sort-item").first(),n=t.find(".matrix-sort-item").first(),s=t.children("li").not(".matrix-empty-slot").first();return{id:t.attr("id"),slotIndex:t.data("slot-index"),slotIndexFromId:(()=>{const e=t.attr("id"),n=e?e.match(new RegExp("matrix_list"+o+"_(\\d+)")):null;return n?n[1]:null})(),hasItemChildren:e.length>0,hasItemFind:n.length>0,hasAnyLi:s.length>0,childrenCount:t.children().length,allChildren:t.children().map((function(){return{tag:this.tagName,classes:this.className,text:$(this).text().trim().substring(0,50)}})).get(),itemText:e.length>0?e.find("small").text().trim():null,itemHtml:e.length>0?e[0].outerHTML.substring(0,200):null}})).get()};if(console.log("Matrix validation:",m),!c&&l.length>0&&l.each((function(){const t=$(this);t.children("li").each((function(){const e=$(this);if(e.hasClass("matrix-empty-slot"))return;const n=e.find("small").text().trim()||e.text().trim();if(n&&!n.toLowerCase().includes("drop")&&!n.toLowerCase().includes("tap")){let e=t.data("slot-index");if(null==e){const n=t.attr("id");if(n){const t=n.match(new RegExp("matrix_list"+o+"_(\\d+)"));t&&t[1]&&(e=parseInt(t[1],10))}}else e=parseInt(e,10);void 0!==e&&!isNaN(e)&&e>=0&&!u[e]&&(u[e]=n,c=!0)}}))})),c&&Object.keys(u).length>0){let e={answer:u,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(e,r,a)}else{const t=d.length>0?"Please fill all answer slots. Missing answers for slot(s): "+d.join(", "):"Missing your answer. Please drag answers into the answer boxes.";toastr.warning(t,"Error",{closeButton:!0,tapToDismiss:!0})}return event&&event.preventDefault(),!1},t.validateBLANKS=(e,n,s,r,i,a)=>{let o=$('input[name^="answer['+s+']"]').map((function(){return $(this).val()})).get();if(console.log(o,s),o){let e={answer:o,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(e,r,a)}else toastr.warning("Answer is required.","Error",{closeButton:!0,tapToDismiss:!0});return event.preventDefault(),!1},t.validateASSESSMENT=(e,n,s,r,i,a)=>{let o=$('input[name="answer['+s+']"]:checked').val();if(o){let e={answer:o,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(e,r,a)}else toastr.warning("Answer is required.","Error",{closeButton:!0,tapToDismiss:!0});return event.preventDefault(),!1},t.validateSINGLE=(e,n,s,r,i,a)=>{let o=$('input[name="answer['+s+']"]').val();if(o){let e={answer:o,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(e,r,a)}else toastr.warning("Answer is required.","Error",{closeButton:!0,tapToDismiss:!0});return event.preventDefault(),!1},t.validateFILE=(e,n,s,r,i,a)=>{let o=new FormData;const l=document.getElementById("file_"+s);let u=null;return u="hidden"===l.getAttribute("type")?l.value:l.files[0],u?(o.append("file",u),o.append("answer",""),o.append("question",s),o.append("quiz",r),o.append("user",i),o.append("_token",$('meta[name="csrf-token"]').attr("content")),t.submitAnswer(o,r,a,!0)):toastr.warning("You need to upload file.","Error",{closeButton:!0,tapToDismiss:!0}),event.preventDefault(),!1},t.validateTABLE=(e,n,s,r,i,a)=>{let o={},l=!1;if(l=$('textarea[name^="answer['+s+']"], input[type="text"][name^="answer['+s+']"]').length>0,l)$('textarea[name^="answer['+s+']"], input[type="text"][name^="answer['+s+']"]').each((function(){const t=$(this).attr("name"),e=$(this).val(),n=t.match(/\[(\d+)\]\[(\d+)\]$/);if(n){const t=n[1],s=n[2];o[t]||(o[t]={}),o[t][s]=e}}));else{$('input[type="checkbox"][name^="answer['+s+']"]').length>0?$('input[type="checkbox"][name^="answer['+s+']"]:checked').each((function(){const t=$(this).attr("name").match(/\[(\d+)\]\[(\d+)\]\[(\d+)\]$/);if(t){const e=t[2];o[e]||(o[e]=[]),o[e].push(t[3])}})):$('input[type="radio"][name^="answer['+s+']"]:checked').each((function(){const t=$(this).attr("name").match(/\[(\d+)\]$/)[1];o[t]=$(this).val()}))}if(0===Object.keys(o).length)toastr.warning("Please provide answers for the question","Error",{closeButton:!0,tapToDismiss:!0});else{let e={answer:o,question:s,quiz:r,user:i,_token:$('meta[name="csrf-token"]').attr("content")};t.submitAnswer(e,r,a)}return event.preventDefault(),!1},t.previous=t=>(t>=0&&n&&n.to(t),event.preventDefault(),!1),t}(Quiz||{});!function(){"use strict";var t=document.querySelectorAll(".bs-stepper"),e=$(".select2");if(null!=t)for(var n=0;n<t.length;++n)t[n].addEventListener("show.bs-stepper",(function(t){for(var e=t.detail.indexStep,n=$(t.target).find(".step").length-1,s=$(t.target).find(".step"),r=0;r<e;r++){s[r].classList.add("crossed");for(var i=e;i<n;i++)s[i].classList.remove("crossed")}if(0==t.detail.to){for(var a=e;a<n;a++)s[a].classList.remove("crossed");s[0].classList.remove("crossed")}}));e.each((function(){var t=$(this);t.wrap('<div class="position-relative form-select-control"></div>'),t.select2({placeholder:"Select value",dropdownParent:t.parent(),allowClear:!0})}))}(window);
