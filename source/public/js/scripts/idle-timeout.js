!function(){"use strict";const e=window.Laravel?.idleTimeout?.timeoutMinutes||120,t=window.Laravel?.idleTimeout?.warningMinutes||5,n=window.Laravel?.idleTimeout?.checkInterval||6e4,o=window.Laravel?.idleTimeout?.updateInterval||3e5;let i=null,a=null,s=null,r=Date.now(),d=!1,l=!1,c=null;function u(){void 0!==window.Laravel&&window.Laravel.user&&(console.log("Idle timeout tracker initialized"),["mousedown","mousemove","keypress","scroll","touchstart","click","keydown","keyup","focus","blur","resize"].forEach((e=>{document.addEventListener(e,m,!0)})),document.addEventListener("visibilitychange",v),window.addEventListener("focus",m),window.addEventListener("blur",m),w(),s=setInterval((()=>{if(l)return;const t=Date.now()-r;Math.floor(t/6e4)>=e?h():t%o<n&&b()}),n),y())}function m(){l||(r=Date.now(),w(),d&&f())}function v(){document.hidden||m()}function w(){i&&clearTimeout(i),a&&clearTimeout(a);const n=60*(e-t)*1e3;console.log("warningTime",n),a=setTimeout(g,n);const o=60*e*1e3;console.log("timeoutTime",o),i=setTimeout(h,o)}function g(){if(d||l)return;d=!0,c||y();let e=60*t;if(p(e),"undefined"!=typeof bootstrap&&bootstrap.Modal){new bootstrap.Modal(c).show()}else c.style.display="block";const n=setInterval((()=>{e--,p(e),e<=0&&clearInterval(n)}),1e3)}function f(){if(d=!1,c)if("undefined"!=typeof bootstrap&&bootstrap.Modal){const e=bootstrap.Modal.getInstance(c);e&&e.hide()}else c.style.display="none"}function p(e){const t=`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,n=c.querySelector("#countdown");n&&(n.textContent=t)}function y(){c||(c=document.createElement("div"),c.className="modal fade",c.id="idle-warning-modal",c.setAttribute("data-bs-backdrop","static"),c.setAttribute("data-bs-keyboard","false"),c.innerHTML='\n            <div class="modal-dialog modal-dialog-centered">\n                <div class="modal-content">\n                    <div class="modal-header bg-warning">\n                        <h5 class="modal-title text-dark">\n                            <i data-lucide="clock" class="me-1"></i>\n                            Are you still there?\n                        </h5>\n                    </div>\n                    <div class="modal-body text-center">\n                        <h6 class="p-1">\n                            <i data-lucide="alert-triangle" class="text-warning" style="font-size: 3rem;"></i>\n                            Your session will expire due to inactivity\n                        </h6>\n                        <p class="text-muted">\n                            You will be automatically logged out in <strong id="countdown">5:00</strong> minutes.\n                        </p>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-outline-secondary" onclick="window.location.href=\'/logout\'">\n                            Logout Now\n                        </button>\n                        <button type="button" class="btn btn-primary" onclick="IdleTimeout.stayLoggedIn()">\n                            Stay Logged In\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ',document.body.appendChild(c))}function h(){l||(l=!0,console.log("Logging out user due to inactivity"),f(),"undefined"!=typeof toastr&&toastr.warning("Your session has expired due to inactivity. Please log in again.","Session Expired"),setTimeout((()=>{window.location.href="/login?timeout=1"}),1e3))}function b(){l||fetch("/api/v1/activity/update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},credentials:"same-origin"}).then((e=>{if(!e.ok)throw new Error("Failed to update activity");return e.json()})).then((e=>{console.log("Activity updated:",e)})).catch((e=>{console.error("Error updating activity:",e)}))}window.IdleTimeout={init:u,destroy:function(){i&&clearTimeout(i),a&&clearTimeout(a),s&&clearInterval(s),["mousedown","mousemove","keypress","scroll","touchstart","click","keydown","keyup","focus","blur","resize"].forEach((e=>{document.removeEventListener(e,m,!0)})),document.removeEventListener("visibilitychange",v),window.removeEventListener("focus",m),window.removeEventListener("blur",m),c&&c.parentNode&&c.parentNode.removeChild(c)},stayLoggedIn:function(){m(),f(),b()},getSessionStatus:function(){return fetch("/api/v1/activity/status",{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},credentials:"same-origin"}).then((e=>e.json())).catch((e=>(console.error("Error getting session status:",e),null)))},updateActivity:b,showWarning:g},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()}();
